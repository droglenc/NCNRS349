---
layout: page
title: Homework Key
subtitle: Stock-Recruitment
author: Derek H. Ogle
css: /css/modules.css
output:
  html_document:
    self_contained: false
    lib_dir: zlibs
---

```{r echo=FALSE, eval=FALSE}
## Renders an appropriate HTML file and moves to CE directory
source("modules/CE/1_CE_KEYS/zzz_modHTML_CEKeys.R")
modHTML_CEKeys("KEY_StockRecruitment_CE1")
```

```{r echo=FALSE, results='hide', message=FALSE}
source("../../../rhelpers/knitr_setup.R")
options(show.signif.stars=FALSE)
```
```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
library(FSA)
library(tidyverse)
library(ggplot2)

wae <- read.csv("https://raw.githubusercontent.com/droglenc/FSAdata/master/data-raw/WalleyeEL.csv")

mnS <- mean(wae$age5)
rckr <- srFuns(type="Ricker")
ind <- srFuns(type="independence")

## Multiplicative Model
svR <- srStarts(age0~age5,data=wae,type="Ricker")
srR <- nls(log(age0)~log(rckr(age5,a,b)),data=wae,start=svR)
cbind(estimates=coef(srR),confint(srR))
predMeanR <- rckr(mnS,a=coef(srR))

## Independence Model
svI <- srStarts(age0~age5,data=wae,type="independence")
srI <- nls(log(age0)~log(ind(age5,a)),data=wae,start=svI)
c(estimates=coef(srI),confint(srI))
predMeanI <- ind(mnS,a=coef(srI))

( test <- extraSS(srI,com=srR) )
```

----

## Escanaba Lake Walleye

1. The abundance of age-0 fish are the recruits and the abundance of age-5 fish is the spawning stock.
1. The relationship between the abundance of age-0 and age-5 fish is weak at best (see figure further below). I do not expect the Ricker stock-recruitment model to fit well.
1. The equation for the density independent model is R=`r formatC(coef(srI)[["a"]],format="f",digits=2)`S. The equation for the Ricker model is R=`r formatC(coef(srR)[["a"]],format="f",digits=2)`S*exp(-`r formatC(coef(srR)[["b"]],format="f",digits=5)`S).
1. The figure is shown further below.
1. The estimated recruitment at the mean stock level of `r formatC(mnS,format="f",digits=0)` is `r formatC(predMeanI,format="f",digits=0)` for the independence model and `r formatC(predMeanR[["Estimate"]],format="f",digits=0)` (95% CI: `r formatC(predMeanR[["2.5%"]],format="f",digits=0)`,`r formatC(predMeanR[["97.5%"]],format="f",digits=0)`) for the Ricker model.
1. The density-dependent Ricker model fits the data significantly better than then density-independent model (`r kPvalue(test[1,"Pr(>F)"])`).

```{r fitPlot, echo=FALSE, warning=FALSE}
x <- seq(0,3000,length.out=499)     # many S for prediction
pRR <- rckr(x,a=coef(srR))          # predicted mean R for Ricker
pIR <- ind(x,a=coef(srI))           # predicted mean R for independence model
preds <- data.frame(s=x,pRR=pRR,pIR=pIR)

ggplot() +
  geom_line(data=preds,mapping=aes(x=s,y=pRR),color="red",size=1) +
  geom_line(data=preds,mapping=aes(x=s,y=pIR),color="gray30",size=1) +
  geom_point(data=wae,mapping=aes(x=age5,y=age0)) +
  scale_x_continuous(name="Number of age-5 Walleye") +
  scale_y_continuous(name="Number of age-0 Walleye") +
  theme_bw()
```

#### R Appendix
```{r eval=FALSE, prompt=FALSE}
<<setup>>
<<fitPlot>>
```
